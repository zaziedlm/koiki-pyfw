# DATABASE設定 (PostgreSQL)
DATABASE_URL=postgresql+asyncpg://koiki_user:koiki_password@db:5432/koiki_todo_db

# PostgreSQL設定
POSTGRES_SERVER=db
POSTGRES_USER=koiki_user
POSTGRES_PASSWORD=koiki_password
POSTGRES_DB=koiki_todo_db
POSTGRES_PORT=5432

# API設定
APP_ENV=development
DEBUG=True

# CORS設定 - フロントエンドからのアクセス許可
BACKEND_CORS_ORIGINS=["http://localhost:3000","http://127.0.0.1:3000"]

# Redis設定 - シンプル版では無効化
REDIS_ENABLED=false
# REDIS_HOST=redis
# REDIS_PORT=6379

# JWT認証設定
JWT_SECRET=jwt_secret_development_only
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60

# ログ設定
LOG_LEVEL=INFO
LOG_FORMAT=json

# =============================
# SSO (OIDC) Configuration - Keycloak設定例
# =============================

# [Required] Keycloak Client設定
SSO_CLIENT_ID=koiki-backend
SSO_CLIENT_SECRET=koiki-backend-secret

# [Required] Keycloak Endpoints（Docker内部通信用）
# for local testing, use localhost:8090
SSO_ISSUER_URL=http://localhost:8090/realms/koiki
SSO_AUTHORIZATION_ENDPOINT=http://localhost:8090/realms/koiki/protocol/openid-connect/auth
# for Docker deployment, use keycloak:8080
# SSO_ISSUER_URL=http://keycloak:8080/realms/koiki
# SSO_AUTHORIZATION_ENDPOINT=http://keycloak:8080/realms/koiki/protocol/openid-connect/auth
SSO_TOKEN_ENDPOINT=http://keycloak:8080/realms/koiki/protocol/openid-connect/token
SSO_JWKS_URI=http://keycloak:8080/realms/koiki/protocol/openid-connect/certs

# Authorization Flow設定
SSO_DEFAULT_SCOPES=openid email profile
SSO_DEFAULT_REDIRECT_URI=http://localhost:3000/sso/callback
SSO_ALLOWED_REDIRECT_URIS=http://localhost:3000/*,http://host.docker.internal:3000/*,http://localhost:8000/auth/sso/callback

# [Required] State token signing key（本番環境では必ず変更）
SSO_STATE_SIGNING_KEY=change_me_state_secret_in_production

# === オプション設定 ===
# Auto-create local users at first SSO login (true/false)
SSO_AUTO_CREATE_USERS=true

# Default SSO provider identifier
SSO_DEFAULT_PROVIDER=oidc

# JWKS cache TTL in seconds
SSO_TOKEN_CACHE_TTL=300

# Allowed email domains (comma-separated). Empty means allow all
SSO_ALLOWED_DOMAINS=

# Require email to be verified by the provider (true/false)
SSO_REQUIRE_EMAIL_VERIFIED=true

# Optional: UserInfo endpoint (used when ID token lacks some claims)
SSO_USER_INFO_ENDPOINT=

# === セキュリティ設定（本番環境では全て有効化推奨） ===
# Validate audience (aud) claim against SSO_CLIENT_ID
SSO_AUDIENCE_VALIDATION=true

# Validate issuer (iss) claim against SSO_ISSUER_URL
SSO_ISSUER_VALIDATION=true

# Validate JWT signature using JWKS
SSO_SIGNATURE_VALIDATION=true

# Validate expiry (exp), not-before (nbf), issued-at (iat)
SSO_EXPIRY_VALIDATION=true

# Clock skew tolerance in seconds for JWT time claims
SSO_CLOCK_SKEW_SECONDS=30

# Accepted JWT signature algorithms (comma-separated)
SSO_ALLOWED_ALGORITHMS=RS256

# Expected authorized party for JWT validation (optional)
SSO_EXPECTED_AZP=

# State token TTL in seconds
SSO_STATE_TTL_SECONDS=600

# === デバッグ設定 ===
# Debug mode (verbose logging; do not enable in production)
SSO_DEBUG_MODE=false

# Skip SSL verification for JWKS/userinfo (development only)
SSO_SKIP_SSL_VERIFY=false

